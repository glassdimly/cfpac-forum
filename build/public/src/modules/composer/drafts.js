"use strict";define("composer/drafts",function(){var t={};var e;var a=false;t.init=function(a,i){var n=a.find("textarea");var l=a.find(".draft-icon");n.on("keyup",function(){r();e=setTimeout(function(){o(a,l,i)},1e3)});l.on("animationend",function(){$(this).toggleClass("active",false)});$(window).on("unload",function(e){try{var a=localStorage.getItem("drafts:open");a=JSON.parse(a)||[]}catch(e){console.warn("[composer/drafts] Could not read list of open/available drafts");a=[]}if(a.length){a.forEach(function(e){t.updateVisibility("open",e)})}})};function r(){if(e){clearTimeout(e);e=0}}t.getDraft=function(t){console.warn("[composer/drafts] drafts.getDraft is deprecated! Use drafts.get() instead.");return localStorage.getItem(t)};t.get=function(t){return{title:localStorage.getItem(t+":title"),text:localStorage.getItem(t)}};function o(e,a,r){var o;var n;if(i()&&r&&r.save_id&&e.length){n=e.find("input.title").val();o=e.find("textarea").val();if(o.length){localStorage.setItem(r.save_id,o);localStorage.setItem(r.save_id+":title",n);a.toggleClass("active",true)}else{t.removeDraft(r.save_id)}}}t.removeDraft=function(e){if(!e){return}r();t.updateVisibility("available",e);t.updateVisibility("open",e);localStorage.removeItem(e);localStorage.removeItem(e+":title");return};t.updateVisibility=function(t,e,a){if(!i()||!e){return}try{var r=localStorage.getItem("drafts:"+t);r=r?JSON.parse(r):[]}catch(t){console.warn("[composer/drafts] Could not read list of open drafts");var r=[]}var o=r.indexOf(e);if(a&&o===-1){r.push(e)}else if(!a&&o!==-1){r.splice(o,1)}localStorage.setItem("drafts:"+t,JSON.stringify(r))};function i(){if(a){return a}try{localStorage.setItem("test","test");localStorage.removeItem("test");a=true;return true}catch(t){a=false;return false}}return t});
//# sourceMappingURL=drafts.js.map