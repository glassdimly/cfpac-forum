{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/categoryList.js"],"names":["define","categorySelector","taskbar","categoryList","selector","init","postContainer","postData","listContainer","find","length","on","toggleDropDirection","socket","emit","err","categories","app","alertError","message","_map","reduce","memo","cur","cid","forEach","category","disabledClass","$","name","translateText","appendTo","updateTaskbar","parseAndTranslate","pullRight","html","append","selectedCategory","hasOwnProperty","changeCategory","selectCategory","getSelectedCategory","addClass","text","this","removeClass","selectedCid","attr","toggleClass","outerHeight","window","height","getSelectedCid","uuid","update","image","background-color","bgColor","icon","slice","require","tags","onChangeCategory"],"mappings":"AACA,aAIAA,OAAO,yBAA0B,mBAAoB,WAAY,SAASC,EAAkBC,GAC3F,IAAIC,KAEJ,IAAIC,EAEJD,EAAaE,KAAO,SAASC,EAAeC,GAC3C,IAAIC,EAAgBF,EAAcG,KAAK,4BACvC,IAAKD,EAAcE,OAAQ,CAC1B,OAGDJ,EAAcK,GAAG,yBAA0B,WAC1CC,EAAoBN,KAGrBO,OAAOC,KAAK,6CAA+C,SAASC,EAAKC,GACxE,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3BhB,EAAaiB,KAAOJ,EAAWK,OAAO,SAAUC,EAAMC,GACrDD,EAAKC,EAAIC,KAAOD,EAChB,OAAOD,OAGRN,EAAWS,QAAQ,SAAUC,GAC5B,IAAKA,EAASC,cAAe,CAC5BC,EAAE,iBAAmBF,EAASF,IAAM,KAAOE,EAASG,KAAO,SAASC,cAAcJ,EAASG,MAAME,SAASH,EAAE,0BAI9GzB,EAAa6B,cAAc1B,EAAeC,GAE1CU,IAAIgB,kBAAkB,8BACrBjB,WAAYA,EACZkB,UAAW,MACT,SAAUC,GACZ3B,EAAc4B,OAAOD,GACrB/B,EAAWH,EAAiBI,KAAKG,EAAcC,KAAK,mCAAoC,SAAU4B,GACjG,GAAI9B,EAAS+B,eAAe,OAAQ,CACnCC,EAAejC,EAAeC,EAAU8B,EAAiBb,QAI3D,GAAIjB,EAASiB,IAAK,CACjBpB,EAASoC,eAAejC,EAASiB,KAGlC,IAAIa,EAAmBjC,EAASqC,sBAEhCb,EAAE,kBAAkBE,cAAcO,EAAmBA,EAAiBR,KAAO,wCAC7ED,EAAE,sBAAsBnB,KAAK,gBAAkBF,EAASiB,IAAM,MAAMkB,SAAS,UAE7E9B,EAAoBN,OAKtBsB,EAAE,sBAAsBjB,GAAG,QAAS,KAAM,WACzCiB,EAAE,kBAAkBe,KAAKf,EAAEgB,MAAMD,QACjCf,EAAE,sBAAsBiB,YAAY,QACpCjB,EAAE,yBAAyBiB,YAAY,UACvCjB,EAAEgB,MAAMF,SAAS,UACjB,IAAII,EAAclB,EAAEgB,MAAMG,KAAK,YAC/B3C,EAASoC,eAAeM,GACxB,GAAIvC,EAAS+B,eAAe,OAAQ,CACnCC,EAAejC,EAAeC,EAAUuC,OAK3C,SAASlC,EAAoBN,GAC5BA,EAAcG,KAAK,4DAA4DuC,YAAY,SAAU1C,EAAc2C,cAAgBrB,EAAEsB,QAAQC,SAAW,GAGzJhD,EAAaiD,eAAiB,WAC7B,IAAIf,EACJ,GAAIjC,EAAU,CACbiC,EAAmBjC,EAASqC,sBAE7B,OAAOJ,EAAmBA,EAAiBb,IAAM,GAGlDrB,EAAa6B,cAAgB,SAAU1B,EAAeC,GACrD,IAAI8C,EAAO/C,EAAcyC,KAAK,aAC9B,IAAIrB,EAAWvB,EAAaiB,KAAKb,EAASiB,KAC1C,GAAIE,EAAU,CACbxB,EAAQoD,OAAO,WAAYD,GAC1BE,MAAO7B,EAAS6B,MAChBC,mBAAoB9B,EAAS+B,QAC7BC,KAAMhC,EAASgC,KAAKC,MAAM,OAK7B,SAASpB,EAAejC,EAAeC,EAAUiB,GAChDjB,EAASiB,IAAMA,EAEfoC,SAAS,iBAAkB,SAAUC,GACpCA,EAAKC,iBAAiBxD,EAAeC,EAAUiB,KAGhDrB,EAAa6B,cAAc1B,EAAeC,GAG3C,OAAOJ","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/categoryList.js","sourcesContent":["\n'use strict';\n\n/*globals define, socket, app*/\n\ndefine('composer/categoryList', ['categorySelector', 'taskbar'], function(categorySelector, taskbar) {\n\tvar categoryList = {};\n\n\tvar selector;\n\n\tcategoryList.init = function(postContainer, postData) {\n\t\tvar listContainer = postContainer.find('.category-list-container');\n\t\tif (!listContainer.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tpostContainer.on('action:composer.resize', function () {\n\t\t\ttoggleDropDirection(postContainer);\n\t\t});\n\n\t\tsocket.emit('plugins.composer.getCategoriesForSelect', {}, function(err, categories) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\t// Save hash for queries\n\t\t\tcategoryList._map = categories.reduce(function (memo, cur) {\n\t\t\t\tmemo[cur.cid] = cur;\n\t\t\t\treturn memo;\n\t\t\t}, {});\n\n\t\t\tcategories.forEach(function (category) {\n\t\t\t\tif (!category.disabledClass) {\n\t\t\t\t\t$('<li data-cid=\"' + category.cid + '\">' + category.name + '</li>').translateText(category.name).appendTo($('.category-selector'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tcategoryList.updateTaskbar(postContainer, postData);\n\n\t\t\tapp.parseAndTranslate('partials/category-selector', {\n\t\t\t\tcategories: categories,\n\t\t\t\tpullRight: true\n\t\t\t}, function (html) {\n\t\t\t\tlistContainer.append(html);\n\t\t\t\tselector = categorySelector.init(listContainer.find('[component=\"category-selector\"]'), function (selectedCategory) {\n\t\t\t\t\tif (postData.hasOwnProperty('cid')) {\n\t\t\t\t\t\tchangeCategory(postContainer, postData, selectedCategory.cid);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (postData.cid) {\n\t\t\t\t\tselector.selectCategory(postData.cid);\n\t\t\t\t}\n\n\t\t\t\tvar selectedCategory = selector.getSelectedCategory();\n\n\t\t\t\t$('.category-name').translateText(selectedCategory ? selectedCategory.name : '[[modules:composer.select_category]]');\n\t\t\t\t$('.category-selector').find('li[data-cid=\"' + postData.cid + '\"]').addClass('active');\n\n\t\t\t\ttoggleDropDirection(postContainer);\n\t\t\t});\n\t\t});\n\n\n\t\t$('.category-selector').on('click', 'li', function() {\n\t\t\t$('.category-name').text($(this).text());\n\t\t\t$('.category-selector').removeClass('open');\n\t\t\t$('.category-selector li').removeClass('active');\n\t\t\t$(this).addClass('active');\n\t\t\tvar selectedCid = $(this).attr('data-cid');\n\t\t\tselector.selectCategory(selectedCid);\n\t\t\tif (postData.hasOwnProperty('cid')) {\n\t\t\t\tchangeCategory(postContainer, postData, selectedCid);\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction toggleDropDirection(postContainer) {\n\t\tpostContainer.find('.category-list-container [component=\"category-selector\"]').toggleClass('dropup', postContainer.outerHeight() < $(window).height() / 2);\n\t}\n\n\tcategoryList.getSelectedCid = function () {\n\t\tvar selectedCategory;\n\t\tif (selector) {\n\t\t\tselectedCategory = selector.getSelectedCategory();\n\t\t}\n\t\treturn selectedCategory ? selectedCategory.cid : 0;\n\t};\n\n\tcategoryList.updateTaskbar = function (postContainer, postData) {\n\t\tvar uuid = postContainer.attr('data-uuid');\n\t\tvar category = categoryList._map[postData.cid];\n\t\tif (category) {\n\t\t\ttaskbar.update('composer', uuid, {\n\t\t\t\timage: category.image,\n\t\t\t\t'background-color': category.bgColor,\n\t\t\t\ticon: category.icon.slice(3),\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction changeCategory(postContainer, postData, cid) {\n\t\tpostData.cid = cid;\n\n\t\trequire(['composer/tags'], function (tags) {\n\t\t\ttags.onChangeCategory(postContainer, postData, cid);\n\t\t});\n\n\t\tcategoryList.updateTaskbar(postContainer, postData);\n\t}\n\n\treturn categoryList;\n});\n"]}