{"version":3,"sources":["public/src/admin/manage/category.js"],"names":["define","uploader","iconSelect","colorpicker","categorySelector","Benchpress","Category","modified_categories","init","$","each","$this","this","val","attr","on","ajaxify","go","window","location","hash","enableColorPicker","idx","inputEl","$inputEl","previewEl","parents","find","enable","hsb","hex","css","modified","handleTags","ev","target","Object","keys","length","socket","emit","err","result","app","alertError","message","flags","_unsaved","alert","title","join","type","timeout","e","preventDefault","parse","name","data","category","topic_count","html","modal","bootbox","dialog","size","buttons","save","label","className","callback","prop","intervalId","setInterval","cid","count","percent","Math","max","width","clearInterval","alertSuccess","categories","allCategories","selectedCid","fromCid","toCid","copyParent","refresh","selectedCategory","show","route","config","relative_path","params","imageUrlOnServer","previewBox","parent","siblings","Date","getTime","addClass","hide","launchParentSelector","payload","parentCid","removeClass","disabled","translateText","toggleClass","el","value","is","tagEl","tagsinput","confirmKeys","trimValue","tagWhitelist","forEach","tag","parseInt","filter","isChild","includes","push","buttonHtml","icon"],"mappings":"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","file":"public/src/admin/manage/category.js","sourcesContent":["'use strict';\n\ndefine('admin/manage/category', [\n\t'uploader',\n\t'iconSelect',\n\t'admin/modules/colorpicker',\n\t'categorySelector',\n\t'benchpress',\n], function (uploader, iconSelect, colorpicker, categorySelector, Benchpress) {\n\tvar\tCategory = {};\n\tvar modified_categories = {};\n\n\tCategory.init = function () {\n\t\t$('#category-settings select').each(function () {\n\t\t\tvar $this = $(this);\n\t\t\t$this.val($this.attr('data-value'));\n\t\t});\n\n\t\t$('#category-selector').on('change', function () {\n\t\t\tajaxify.go('admin/manage/categories/' + $(this).val() + window.location.hash);\n\t\t});\n\n\t\tfunction enableColorPicker(idx, inputEl) {\n\t\t\tvar $inputEl = $(inputEl);\n\t\t\tvar previewEl = $inputEl.parents('[data-cid]').find('.category-preview');\n\n\t\t\tcolorpicker.enable($inputEl, function (hsb, hex) {\n\t\t\t\tif ($inputEl.attr('data-name') === 'bgColor') {\n\t\t\t\t\tpreviewEl.css('background-color', '#' + hex);\n\t\t\t\t} else if ($inputEl.attr('data-name') === 'color') {\n\t\t\t\t\tpreviewEl.css('color', '#' + hex);\n\t\t\t\t}\n\n\t\t\t\tmodified($inputEl[0]);\n\t\t\t});\n\t\t}\n\n\t\thandleTags();\n\n\t\t$('#category-settings input, #category-settings select').on('change', function (ev) {\n\t\t\tmodified(ev.target);\n\t\t});\n\n\t\t$('[data-name=\"imageClass\"]').on('change', function () {\n\t\t\t$('.category-preview').css('background-size', $(this).val());\n\t\t});\n\n\t\t$('[data-name=\"bgColor\"], [data-name=\"color\"]').each(enableColorPicker);\n\n\t\t$('#save').on('click', function () {\n\t\t\tif (Object.keys(modified_categories).length) {\n\t\t\t\tsocket.emit('admin.categories.update', modified_categories, function (err, result) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (result && result.length) {\n\t\t\t\t\t\tapp.flags._unsaved = false;\n\t\t\t\t\t\tapp.alert({\n\t\t\t\t\t\t\ttitle: 'Updated Categories',\n\t\t\t\t\t\t\tmessage: 'Category IDs ' + result.join(', ') + ' was successfully updated.',\n\t\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\t\ttimeout: 2000,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tmodified_categories = {};\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\t$('.purge').on('click', function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tBenchpress.parse('admin/partials/categories/purge', {\n\t\t\t\tname: ajaxify.data.category.name,\n\t\t\t\ttopic_count: ajaxify.data.category.topic_count,\n\t\t\t}, function (html) {\n\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\ttitle: '[[admin/manage/categories:purge]]',\n\t\t\t\t\tmessage: html,\n\t\t\t\t\tsize: 'large',\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\tsave: {\n\t\t\t\t\t\t\tlabel: '[[modules:bootbox.confirm]]',\n\t\t\t\t\t\t\tclassName: 'btn-primary',\n\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\tmodal.find('.modal-footer button').prop('disabled', true);\n\n\t\t\t\t\t\t\t\tvar intervalId = setInterval(function () {\n\t\t\t\t\t\t\t\t\tsocket.emit('categories.getTopicCount', ajaxify.data.category.cid, function (err, count) {\n\t\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tvar percent = 0;\n\t\t\t\t\t\t\t\t\t\tif (ajaxify.data.category.topic_count > 0) {\n\t\t\t\t\t\t\t\t\t\t\tpercent = Math.max(0, (1 - (count / ajaxify.data.category.topic_count))) * 100;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tmodal.find('.progress-bar').css({ width: percent + '%' });\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}, 1000);\n\n\t\t\t\t\t\t\t\tsocket.emit('admin.categories.purge', ajaxify.data.category.cid, function (err) {\n\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (intervalId) {\n\t\t\t\t\t\t\t\t\t\tclearInterval(intervalId);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tmodal.modal('hide');\n\t\t\t\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/categories:alert.purge-success]]');\n\t\t\t\t\t\t\t\t\tajaxify.go('admin/manage/categories');\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.copy-settings').on('click', function () {\n\t\t\tBenchpress.parse('admin/partials/categories/copy-settings', {\n\t\t\t\tcategories: ajaxify.data.allCategories,\n\t\t\t}, function (html) {\n\t\t\t\tvar selectedCid;\n\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\ttitle: '[[modules:composer.select_category]]',\n\t\t\t\t\tmessage: html,\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\tsave: {\n\t\t\t\t\t\t\tlabel: '[[modules:bootbox.confirm]]',\n\t\t\t\t\t\t\tclassName: 'btn-primary',\n\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\tif (!selectedCid) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tsocket.emit('admin.categories.copySettingsFrom', {\n\t\t\t\t\t\t\t\t\tfromCid: selectedCid,\n\t\t\t\t\t\t\t\t\ttoCid: ajaxify.data.category.cid,\n\t\t\t\t\t\t\t\t\tcopyParent: modal.find('#copyParent').prop('checked'),\n\t\t\t\t\t\t\t\t}, function (err) {\n\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tmodal.modal('hide');\n\t\t\t\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/categories:alert.copy-success]]');\n\t\t\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tmodal.find('.modal-footer button').prop('disabled', true);\n\t\t\t\tcategorySelector.init(modal.find('[component=\"category-selector\"]'), function (selectedCategory) {\n\t\t\t\t\tselectedCid = selectedCategory && selectedCategory.cid;\n\t\t\t\t\tif (selectedCid) {\n\t\t\t\t\t\tmodal.find('.modal-footer button').prop('disabled', false);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\n\t\t$('.upload-button').on('click', function () {\n\t\t\tvar inputEl = $(this);\n\t\t\tvar cid = inputEl.attr('data-cid');\n\n\t\t\tuploader.show({\n\t\t\t\ttitle: '[[admin/manage/categories:alert.upload-image]]',\n\t\t\t\troute: config.relative_path + '/api/admin/category/uploadpicture',\n\t\t\t\tparams: { cid: cid },\n\t\t\t}, function (imageUrlOnServer) {\n\t\t\t\t$('#category-image').val(imageUrlOnServer);\n\t\t\t\tvar previewBox = inputEl.parent().parent().siblings('.category-preview');\n\t\t\t\tpreviewBox.css('background', 'url(' + imageUrlOnServer + '?' + new Date().getTime() + ')');\n\n\t\t\t\tmodified($('#category-image'));\n\t\t\t});\n\t\t});\n\n\t\t$('#category-image').on('change', function () {\n\t\t\t$('.category-preview').css('background-image', $(this).val() ? ('url(\"' + $(this).val() + '\")') : '');\n\t\t\tmodified($('#category-image'));\n\t\t});\n\n\t\t$('.delete-image').on('click', function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar inputEl = $('#category-image');\n\t\t\tvar previewBox = $('.category-preview');\n\n\t\t\tinputEl.val('');\n\t\t\tpreviewBox.css('background-image', '');\n\t\t\tmodified(inputEl[0]);\n\t\t\t$(this).parent().addClass('hide').hide();\n\t\t});\n\n\t\t$('.category-preview').on('click', function () {\n\t\t\ticonSelect.init($(this).find('i'), modified);\n\t\t});\n\n\t\t$('[type=\"checkbox\"]').on('change', function () {\n\t\t\tmodified($(this));\n\t\t});\n\n\t\t$('button[data-action=\"setParent\"], button[data-action=\"changeParent\"]').on('click', Category.launchParentSelector);\n\t\t$('button[data-action=\"removeParent\"]').on('click', function () {\n\t\t\tvar payload = {};\n\t\t\tpayload[ajaxify.data.category.cid] = {\n\t\t\t\tparentCid: 0,\n\t\t\t};\n\n\t\t\tsocket.emit('admin.categories.update', payload, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\t$('button[data-action=\"removeParent\"]').parent().addClass('hide');\n\t\t\t\t$('button[data-action=\"changeParent\"]').parent().addClass('hide');\n\t\t\t\t$('button[data-action=\"setParent\"]').removeClass('hide');\n\t\t\t});\n\t\t});\n\t\t$('button[data-action=\"toggle\"]').on('click', function () {\n\t\t\tvar payload = {};\n\t\t\tvar $this = $(this);\n\t\t\tvar disabled = $this.attr('data-disabled') === '1';\n\t\t\tpayload[ajaxify.data.category.cid] = {\n\t\t\t\tdisabled: disabled ? 0 : 1,\n\t\t\t};\n\t\t\tsocket.emit('admin.categories.update', payload, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\t$this.translateText(!disabled ? '[[admin/manage/categories:enable]]' : '[[admin/manage/categories:disable]]');\n\t\t\t\t$this.toggleClass('btn-primary', !disabled).toggleClass('btn-danger', disabled);\n\t\t\t\t$this.attr('data-disabled', disabled ? 0 : 1);\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction modified(el) {\n\t\tvar cid = ajaxify.data.category.cid;\n\n\t\tif (cid) {\n\t\t\tvar value;\n\t\t\tif ($(el).is(':checkbox')) {\n\t\t\t\tvalue = $(el).is(':checked') ? 1 : 0;\n\t\t\t} else {\n\t\t\t\tvalue = $(el).val();\n\t\t\t}\n\n\t\t\tmodified_categories[cid] = modified_categories[cid] || {};\n\t\t\tmodified_categories[cid][$(el).attr('data-name')] = value;\n\n\t\t\tapp.flags = app.flags || {};\n\t\t\tapp.flags._unsaved = true;\n\t\t}\n\t}\n\n\tfunction handleTags() {\n\t\tvar tagEl = $('#tag-whitelist');\n\t\ttagEl.tagsinput({\n\t\t\tconfirmKeys: [13, 44],\n\t\t\ttrimValue: true,\n\t\t});\n\n\t\tajaxify.data.category.tagWhitelist.forEach(function (tag) {\n\t\t\ttagEl.tagsinput('add', tag);\n\t\t});\n\n\t\ttagEl.on('itemAdded itemRemoved', function () {\n\t\t\tmodified(tagEl);\n\t\t});\n\t}\n\n\tCategory.launchParentSelector = function () {\n\t\tvar parents = [parseInt(ajaxify.data.category.cid, 10)];\n\t\tvar categories = ajaxify.data.allCategories.filter(function (category) {\n\t\t\tvar isChild = parents.includes(parseInt(category.parentCid, 10));\n\t\t\tif (isChild) {\n\t\t\t\tparents.push(parseInt(category.cid, 10));\n\t\t\t}\n\t\t\treturn category && !category.disabled && parseInt(category.cid, 10) !== parseInt(ajaxify.data.category.cid, 10) && !isChild;\n\t\t});\n\n\t\tcategorySelector.modal(categories, function (parentCid) {\n\t\t\tvar payload = {};\n\n\t\t\tpayload[ajaxify.data.category.cid] = {\n\t\t\t\tparentCid: parentCid,\n\t\t\t};\n\n\t\t\tsocket.emit('admin.categories.update', payload, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tvar parent = ajaxify.data.allCategories.filter(function (category) {\n\t\t\t\t\treturn category && parseInt(category.cid, 10) === parseInt(parentCid, 10);\n\t\t\t\t});\n\t\t\t\tparent = parent[0];\n\n\t\t\t\t$('button[data-action=\"removeParent\"]').parent().removeClass('hide');\n\t\t\t\t$('button[data-action=\"setParent\"]').addClass('hide');\n\t\t\t\tvar buttonHtml = '<i class=\"fa ' + parent.icon + '\"></i> ' + parent.name;\n\t\t\t\t$('button[data-action=\"changeParent\"]').html(buttonHtml).parent().removeClass('hide');\n\t\t\t});\n\t\t});\n\t};\n\n\treturn Category;\n});\n"]}